#!/bin/sh

module purge
module load pbsutils

case $COMPILER_TYPE in
    ThirdParty)
	;;
    system)
	case "$COMPILER" in
	    Gcc4_8_5)
		# system default version
		;;
	    Gcc*)
		version=${COMPILER#Gcc}
		version=${version//_/.}
		module load gnu/gcc_$version
		;;
	    Icc*)
		version=${COMPILER#Icc}
		version=${version//_/.}
		module load intel/$version
		;;
	    *)
		;;
	esac	
	;;
    *)
	;;
esac

case $MPLIB in
    SYSTEMOPENMPI*)
	version=${MPLIB#SYSTEMOPENMPI}
	version=${version//_/.}
	case "$COMPILER" in
	    Gcc*)
		module load openmpi/$version/gnu
		;;
	    Icc*)
		module load openmpi/$version/intel
		;;
	esac	
	;;
    SGIMPI*)
	version=${MPLIB#SGIMPI}
	version=${version//_/.}
	module load mpt/$version
	;;
    INTELMPI*)
	version=${MPLIB#INTELMPI}
	version=${version//_/.}
	module load intel-mpi/$version
	;;
    MPIMVAPICH2_2_2)
	case "$COMPILER" in
	    Gcc*)
		module load mvapich2/2.2/gnu
		;;
	    Icc*)
		module load mvapich2/2.2/intel
		;;
	esac	
	MPI_ROOT=`which mpirun`
	export MPI_ROOT=${MPI_ROOT/\/bin\/mpirun/}
	;;
    HPCXMPI1_8_0)
	version=${MPLIB#HPCXMPI}
	version=${version//_/.}
	case "$COMPILER" in
	    Gcc*)
		module load hpcx/$version/gnu
		;;
	    Icc*)
		module load hpcx/$version/intel
		;;
	esac	
	export MPI_ROOT=$MPI_HOME
	;;
    *)
	;;
esac

case $MPLIB in
    INTELMPI*)
	export MPI_ROOT=$I_MPI_ROOT
	;;
esac
